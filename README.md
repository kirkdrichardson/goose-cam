# GOOSE CAM

In essence, a Python script to upload files to a Google Drive account. After initial setup and authentication, the script is capable of refreshing the access token needed to authenticate so that a third party, in this case a Raspberry Pi, may upload files in the background without user input.

Together with a Raspberry Pi and the [Motion package](https://motion-project.github.io/index.html), we can create a spy cam that will take pictures and/or video on motion, upload them to a Google Drive account, and then delete them locally.

## Why?

My partner and I suspected our dog, Goose, might be sneaking food from his food bag. Rather than move the bag from the floor, we devised a plan to catch him in the act if he was indeed eating more than his share. Thus was Goose Cam born. 

## What do I need?

**Hardware**: A Raspberry Pi 3 and a PS3 Eye USB Camera (or most any camera will do)
**Software**:  The [Motion package](https://motion-project.github.io/index.html), which provides tons of configuration options, allows for streaming of video, and exposes the script execution hooks that we will use to upload images and/or video to Google Drive.

## Setup
Once you have installed your Linux distro of choice on your rPi, install the  [Motion package](https://motion-project.github.io/index.html) as you wish. Probably the easiest way is via ```sudo apt-get install motion```

Consult the documentation and configure to your wishes. In order to process photos and videos, we will be using the  [ on_picture_save](https://motion-project.github.io/motion_config.html#on_picture_save) and  [ on_movie_end](https://motion-project.github.io/motion_config.html#on_movie_end) to execute the ```upload.py``` script in order to save photos and videos, respectively.

## Usage
The ```upload.py``` script  can be used outside of the context of the Motion package. It requires only that a file path is provided, e.g. ```python3 upload.py "/home/user/my_file.jpg"```.

**Configuration**: 
However, the ```config.py``` file is necessary for the ```upload.py``` script to work. Each of the variables in that file must be defined as a Python string.

```ENV_ACCESS_TOKEN_FILE_PATH```  - This is where the access token used to authenticate into Google Drive is stored on your machine, e.g. ```"/home/user/Projects/goose-cam/access_token.txt"```

```ENV_CLIENT_ID```  The unique ID of the client authorized to upload files to Drive

```ENV_CLIENT_SECRET```  =  The secret for this client

```ENV_REFRESH_TOKEN```  =  A token provided to the client specified above that can be used to request an access token. Does not expire.

For more information on these last 3 items, see the  [Google OAuth Documentation](https://developers.google.com/identity/protocols/oauth2). For troubleshooting, or for a more practical how-to guide, see [this article](http://dillysadventures.blogspot.com/2017/11/sending-email-using-gmail-api-all-you.html).

**Final steps**
Once you have your rPi setup, motion installed, and the config assigned with your credentials, all that is left is to direct motion to run the ```upload.py``` script whenever it saves a picture and/or finishes compiling a movie, passing the path to the file generated by the Motion program to the upload script:

In the motion config file ```/etc/motion/motion.conf``` search for the ```on_picture_save``` and ```on_movie_end``` options and configure to run the upload script, e.g.
```
on_picture_save python3 "/home/user/goose-cam/upload.py" %s
```
Then, start motion in daemon mode ```sudo motion```, and you're done!

## Debugging
- Ensure your Google credentials are correct.
- Try manually uploading an image using the upload script

See ```/var/log/motion/motion.log``` for motion-specific logs and ```/var/tmp/goose_cam.log``` for logs originating from the ```upload.py``` script. 